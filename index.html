<!DOCTYPE html>
<html>

<head>
    <title>Paint by number generator</title>
    <link rel="stylesheet" href="styles/lib/materialize.min.css">
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    <link rel='stylesheet' href='styles/main.css' />
    <link rel="stylesheet" type="text/css" href="style.css">
</head>

<body>
    <div id="main">
        <!-- step-1 -->
        <div id="step1">
            <center>
                <h1>Генератор картины по номерам</h1>
            </center>
            <p style="font-size: 22px; text-align: center;">Выберите форму картины:</p>
            <div style="display: flex;" class="radio-img-container">
                <img src="circ.webp" data-original-src="circ.webp" data-alternate-src="circ_active.webp" alt="Круг"
                    class="radio-img" data-value="0">
                <img src="squar.webp" data-original-src="squar.webp" data-alternate-src="squar_active.webp"
                    alt="Квадрат" class="radio-img" data-value="1">
                <img src="paper.webp" data-original-src="paper.webp" data-alternate-src="paper_active.webp"
                    alt="Лист бумаги" class="radio-img" data-value="2">
            </div>
            <br>
            <!-- <input style="display: flex; width: 100%; " ></input> -->
            <input type="file" accept="image/x-png,image/gif,image/jpeg" id="file" type="file" style="display:none;" />
            <label for="file"
                style="display: inline-block; padding: 10px 20px; border-radius: 10px; background-color: #f1f1f1; cursor: pointer; border: 2px solid #ddd; font-size: 16px; text-align: center; width: 70%; margin-left: auto; margin-right: auto;">
                Выберите файл
            </label>
            <br />
            <div id="imageContainer" style="display: flex; align-items: center; justify-content: center; width: 480px; overflow: hidden;">
                <canvas id="canvas"></canvas>
            </div>
            <label for="scaleSlider" style="margin-top: 5px;">Масштаб:</label> <input type="range" id="scaleSlider"
                min="10" max="200" value="100" oninput="changeScale(this.value)">
            <label for="rotateSlider">Поворот:</label> <input type="range" id="rotateSlider" min="-180" max="180"
                value="0" oninput="rotateImage(this.value)">
            <div id="input-pane" class="col s12">

                <img id="imgTrivial" crossorigin="anonymous" src="https://i.imgur.com/o5CqO57.png"
                    style="display:none" />
                <img id="imgSmall" crossorigin="anonymous" src="https://i.imgur.com/YgYLDGP.png" style="display:none" />

                <img id="imgMedium" crossorigin="anonymous" src="https://i.imgur.com/nLeNgYbr.jpg"
                    style="display:none" />
            </div>
        </div>
        <!-- step-1-end -->
        <!-- step-2-->
        <div id="step2">
            <center>
                <h1>Настройка параметров</h1>
            </center>
            <div id="options-pane" class="col s12">
                <ul class="collection">
                    <li class="collection-item">
                        <div style="display: flex; width: 100%; align-items: center; justify-content: space-between;"
                            class="row">
                            <div class="input-field col ">
                                <input id="txtNrOfClusters" type="number" value="16" min="1" class="validate">
                                <label for="txtNrOfClusters">Number of colors
                                </label>
                            </div>

                            <div class="input-field col ">
                                <input id="txtClusterPrecision" type="number" value="1" min="1" step="0.05"
                                    class="validate">
                                <label for="txtClusterPrecision">Cluster precision

                                </label>
                            </div>

                            <div class="input-field col">
                                <input id="txtRandomSeed" type="number" value="0" min="0" step="1" class="validate">
                                <label for="txtRandomSeed">Random seed

                                </label>
                            </div>
                        </div>
                    </li>
                    <li class="collection-item">
                        <div class="row">

                            <div class="col s3">
                                <label>Clustering color space

                                </label>
                            </div>
                            <div class="col s2">
                                <label>
                                    <input id="optColorSpaceRGB" name="colorspace" type="radio" checked />
                                    <span>RGB</span>
                                </label>
                            </div>
                            <div class="col s2">
                                <label>
                                    <input id="optColorSpaceHSL" name="colorspace" type="radio" />
                                    <span>HSL</span>
                                </label>
                            </div>
                            <div class="col s2">
                                <label>
                                    <input id="optColorSpaceLAB" name="colorspace" type="radio" />
                                    <span>Lab</span>
                                </label>
                            </div>

                            <div style="display: flex;align-items: start; height: 30px; margin-bottom: 30px;"
                                class="col s12">
                                <label for="txtKMeansColorRestrictions">Restrict clustering colors
                                </label>

                                <textarea style="height: 30px;" id="txtKMeansColorRestrictions"
                                    placeholder="255,255,255" class="materialize-textarea validate" name="" id=""
                                    cols="30" rows="10"></textarea>
                            </div>
                        </div>
                    </li>
                    <li class="collection-item">
                        <div class="row">
                            <div class="input-field col s4">
                                <input style="margin-top: 20px;" id="txtNarrowPixelStripCleanupRuns" type="number"
                                    value="3" min="0" class="validate">
                                <label for="txtNarrowPixelStripCleanupRuns">Number of runs for narrow pixel
                                    cleanup</label>
                            </div>
                            <div class="input-field col s4">
                                <input style="margin-top: 20px;" id="txtRemoveFacetsSmallerThan" type="number"
                                    value="20" min="1" class="validate">
                                <label for="txtRemoveFacetsSmallerThan">Remove small facets smaller than (pixels)

                                </label>
                            </div>
                            <div class="input-field col s4">
                                <input style="margin-top: 20px;" id="txtMaximumNumberOfFacets" type="number"
                                    value="100000" min="1" class="validate">
                                <label for="txtMaximumNumberOfFacets">Maximum number of facets

                                </label>
                            </div>
                        </div>
                        <div class="row">
                            <div class="input-field col s6">
                                <div class="row">
                                    <div class="col s4">
                                        <label>Small facet removal order

                                        </label>
                                    </div>
                                    <div style="" class="col s4">
                                        <label>
                                            <input id="optFacetRemovalLargestToSmallest" name="smallfacetremovalorder"
                                                type="radio" checked />
                                            <span>Largest to smallest</span>
                                        </label>
                                    </div>
                                    <div class="col s4">
                                        <label>
                                            <input id="optFacetRemovalSmallestToLargest" name="smallfacetremovalorder"
                                                type="radio" />
                                            <span>Smallest to largest</span>
                                        </label>
                                    </div>
                                </div>
                            </div>

                        </div>
                    </li>
                    <li class="collection-item">
                        <div class="row">
                            <div class="input-field col s5">
                                <input style="margin-top: 10px;" id="txtNrOfTimesToHalveBorderSegments" type="number"
                                    value="2" min="0" class="validate">
                                <label for="txtNrOfTimesToHalveBorderSegments">Amount of times to halve border segment
                                    complexity)

                                </label>
                            </div>
                        </div>
                    </li>
                </ul>

            </div>

            <!-- <div class="col s12"> -->
            <button class="waves-effect waves-light btn" id="btnProcess">Сгенерировать картину</button>
            <!-- </div> -->
        </div>
        <!-- step-2-end -->
        <div id="step3">
            <center>
                <h1>Результат</h1>
            </center>
            <div class="row">
                <div class="col s2">
                    <div class="status kMeans">
                        K-means clustering
                        <div class="progress">
                            <div id="statusKMeans" class="determinate" style="width: 0%"></div>
                        </div>
                    </div>
                </div>
                <div class="col s2">
                    <div class="status facetBuilding">
                        Facet building
                        <div class="progress">
                            <div id="statusFacetBuilding" class="determinate" style="width: 0%"></div>
                        </div>
                    </div>
                </div>
                <div class="col s2">
                    <div class="status facetReduction">
                        Small facet pruning
                        <div class="progress">
                            <div id="statusFacetReduction" class="determinate" style="width: 0%"></div>
                        </div>
                    </div>
                </div>
                <div class="col s2">
                    <div class="status facetBorderPath">
                        Border detection
                        <div class="progress">
                            <div id="statusFacetBorderPath" class="determinate" style="width: 0%"></div>
                        </div>
                    </div>
                </div>
                <div class="col s2">
                    <div class="status facetBorderSegmentation">
                        Border segmentation
                        <div class="progress">
                            <div id="statusFacetBorderSegmentation" class="determinate" style="width: 0%"></div>
                        </div>
                    </div>
                </div>
                <div class="col s2">
                    <div class="status facetLabelPlacement">
                        Label placement
                        <div class="progress">
                            <div id="statusFacetLabelPlacement" class="determinate" style="width: 0%"></div>
                        </div>
                    </div>
                </div>
            </div>

            <div style="overflow-x:hidden;" class="row">
                <div class="col s12">
                    <ul style="display: none;" id="tabsOutput" class="tabs">
                        <li class="tab col s2">
                            <a href="#kmeans-pane">Quantized image</a>
                        </li>
                        <li class="tab col s2">
                            <a href="#reduction-pane">Facet reduction</a>
                        </li>
                        <li class="tab col s2">
                            <a href="#borderpath-pane">Border tracing</a>
                        </li>
                        <li class="tab col s2">
                            <a href="#bordersegmentation-pane">Border segmentation</a>
                        </li>
                        <li class="tab col s2">
                            <a href="#labelplacement-pane">Label placement</a>
                        </li>
                        <li class="tab col s2">
                            <a href="#output-pane">Output</a>
                        </li>
                        <li class="tab col s2">
                            <a href="#log-pane">Log</a>
                        </li>
                    </ul>
                </div>
                <div style="display: flex; align-items: center; justify-content: center; overflow: scroll; width: 480px; height: 480px;" id="kmeans-pane" class="col s12">
                    <canvas id="cKMeans"></canvas>
                </div>
                <div style="display: flex; align-items: center; justify-content: center; overflow: scroll; width: 480px; height: 480px;" id="reduction-pane" class="col s12">
                    <canvas id="cReduction"></canvas>
                </div>
                <div style="display: flex; align-items: center; justify-content: center; overflow: scroll; width: 480px; height: 480px;" id="borderpath-pane" class="col s12">
                    <canvas id="cBorderPath"></canvas>
                </div>
                <div style="display: flex; align-items: center; justify-content: center; overflow: scroll; width: 480px; height: 480px;" id="bordersegmentation-pane" class="col s12">
                    <canvas id="cBorderSegmentation"></canvas>
                </div>
                <div style="display: flex; align-items: center; justify-content: center; overflow: scroll; width: 480px; height: 480px; content-visibility: unset;" id="labelplacement-pane" class="col s12">
                    <canvas id="cLabelPlacement"></canvas>
                </div>


                <div id="output-pane" class="col s12">
                    <div style="" class="row">
                        <div class="">
                            <label>SVG Render options</label>
                        </div>
                        <div class="">
                            <label>
                                <input id="chkShowLabels" type="checkbox" checked="checked" />
                                <span>Show labels</span>
                            </label>
                        </div>
                        <div class="">
                            <label>
                                <input id="chkFillFacets" type="checkbox" checked="checked" />
                                <span>Fill facets</span>
                            </label>
                        </div>
                        <div class="">
                            <label>
                                <input id="chkShowBorders" type="checkbox" checked="checked" />
                                <span>Show borders</span>
                            </label>
                        </div>
                    </div>
                    <div style="display:flex ; flex-direction: column;" class="">
                        <div style="display: center; width: 200px;" class="col ">
                            <div class="input-field">
                                <input placeholder="SVG Size multiplier" id="txtSizeMultiplier" type="number" value="3"
                                    min="1" class="validate">
                                <label for="txtSizeMultiplier">SVG size multiplier

                                </label>
                            </div>
                        </div>
                        <div style="display: center; width: 200px;" class="col">
                            <div class="input-field">
                                <input placeholder="Label font size" id="txtLabelFontSize" type="number" value="50"
                                    min="1" max="100">
                                <label for="txtLabelFontSize">Label font size

                                </label>
                            </div>
                        </div>
                        <div style="display: center; width: 200px;" class="col">
                            <div class="input-field">
                                <input placeholder="Label font size" id="txtLabelFontColor" type="text" value="#000">
                                <label for="txtLabelFontColor">Label font color

                                </label>
                            </div>
                        </div>
                    </div>
                    <div style="display: flex; align-items: center; flex-wrap: wrap;" class="row">
                        <div  id="palette" class="palette">

                        </div>
                    </div>
                    <div style="display: flex; overflow: scroll; width: 480px;" class="row">
                        <div class="col">
                            <div style="width: 100%; height: 100%;" id="svgContainer">

                            </div>
                        </div>
                    </div>

                    <div class="row">
                        <div style="display: flex; align-items: center; justify-content: space-between;" class="">
                            <a style="cursor: pointer; display: flex; align-items: center; justify-content: center; width: 150px; height: 50px; color: white; background-color: blue; border-radius: 10px;"
                                class="waves-effect waves-light btn" id="btnDownloadSVG">Download SVG</a>
                            <a style="cursor: pointer; display: flex; align-items: center; justify-content: center; width: 150px; height: 50px; color: white; background-color: blue; border-radius: 10px;"
                                class="waves-effect waves-light btn" id="btnDownloadPNG">Download PNG</a>
                            <a style="cursor: pointer; display: flex; align-items: center; justify-content: center; width: 150px; height: 50px; color: white; background-color: blue; border-radius: 10px;"
                                class="waves-effect waves-light btn" id="btnDownloadPalettePNG">Download palette</a>
                        </div>
                        <!-- <div class="col s3">
                       
                    </div>
                    <div class="col s3">
                        
                    </div> -->
                    </div>
                </div>
                <div id="log-pane" class="col s12">
                    <div class="row">
                        <div class="col s12">
                            <div id="log"></div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Img Shape select -->
    <script>
        let selectedImage = null;

        document.addEventListener('DOMContentLoaded', function () {
            const container = document.querySelector('.radio-img-container');
            const images = container.querySelectorAll('.radio-img');


            // Получить элементы контейнеров по их id
            const imageContainer = document.getElementById('imageContainer');
            const imageContainer2 = document.getElementById('imageContainer2');
            const imageContainer3 = document.getElementById('imageContainer3');

            images.forEach(img => {
                img.addEventListener('click', function () {
                    if (selectedImage && selectedImage !== this) {
                        selectedImage.src = selectedImage.getAttribute('data-original-src');
                        selectedImage.classList.remove('selected');
                    }

                    // Если это изображение уже выбрано, не делаем ничего
                    if (selectedImage !== this) {
                        // Меняем изображение на выбранное
                        this.src = this.getAttribute('data-alternate-src');
                        this.classList.add('selected');
                        selectedImage = this;
                    } else {
                        // Возвращаем изображение на исходное
                        this.src = this.getAttribute('data-original-src');
                        this.classList.remove('selected');
                        selectedImage = null;
                    }

                    // Получить значение data-value выбранного изображения
                    const value = this.getAttribute('data-value');

                    // Установить значение data-value для каждого контейнера
                    imageContainer.setAttribute('data-value', value);
                    imageContainer2.setAttribute('data-value', value);
                    imageContainer3.setAttribute('data-value', value);
                });
            });

            images[0].click(); // Выбираем первое изображение по умолчанию
        });
    </script>
    <!-- Img shape select script end -->

    <script src="showImage.js"></script>
    <script src="scripts/lib/saveSvgAsPng.js"></script>
    <script src="scripts/lib/require.js"></script>
    <script src="scripts/lib/jquery-1.11.0.min.js"></script>
    <script src="scripts/lib/materialize.min.js"></script>
    <script src='scripts/main.js'></script>
    <script>
        requirejs(['main'], function (MyApp) {

        });
    </script>
</body>

</html>